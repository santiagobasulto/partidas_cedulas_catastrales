Really ugly code. Not tested. You need data to use this.
